#include <msp430.h>

// Определение выводов светодиодов
#define LED1 BIT0          // Светодиод для индикации "иных сигналов"
#define LED3 BIT1          // Светодиод для индикации потенциометра
#define LED_PAD BIT2       // Светодиод для индикации тач-панели

// Функция настройки компаратора
void configureComparator() {
    // Настройка входов компаратора для PAD2 и потенциометра
    CBCTL0 |= CBIPEN + CBIPSEL_2;       // Включить компаратор, выбор PAD2 как вход "+" (CB0)
    CBCTL0 |= CBIMEN + CBIMSEL_0;       // Включить "-" вход, подключить его к каналу CB1 для потенциометра
    CBCTL1 |= CBPWRMD_1;                // Режим низкого энергопотребления для компаратора
    CBCTL1 |= CBON;                     // Включить компаратор
    
    // Ожидание стабилизации компаратора
    __delay_cycles(75);                 // Задержка для стабилизации
}

// Основная функция
int main(void) {
    WDTCTL = WDTPW | WDTHOLD;           // Остановка Watchdog Timer

    // Настройка светодиодов как выходы
    P1DIR |= LED1 + LED3 + LED_PAD;     // Установка светодиодов как выходы
    P1OUT &= ~(LED1 + LED3 + LED_PAD);  // Выключение всех светодиодов
    
    configureComparator();               // Настройка компаратора
    
    while (1) {
        // Проверка состояния компаратора
        if (CBCTL1 & CBOUT) {            // Если выход компаратора высокий (PAD2 > потенциометр)
            P1OUT |= LED_PAD;            // Включить светодиод для тач-панели
            P1OUT &= ~LED3;              // Выключить светодиод для потенциометра
            P1OUT &= ~LED1;              // Выключить светодиод для "иных сигналов"
        } else {                         // Если выход компаратора низкий (PAD2 < потенциометр)
            P1OUT |= LED3;               // Включить светодиод для потенциометра
            P1OUT &= ~LED_PAD;           // Выключить светодиод для тач-панели
            P1OUT &= ~LED1;              // Выключить светодиод для "иных сигналов"
        }
        
        // // Дополнительная логика для иного сигнала
        // if (/* условие для иного сигнала */) {
        //     P1OUT |= LED1;               // Включить светодиод для "иных сигналов"
        //     P1OUT &= ~LED_PAD;           // Выключить LED_PAD
        //     P1OUT &= ~LED3;              // Выключить LED3
        // }
        
        __delay_cycles(1000);            // Задержка для стабилизации и снижения энергопотребления
    }
}